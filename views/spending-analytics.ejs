<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Spending Analytics | WPG Wallet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">
  <%- include("partials/header", { user: user, notificationCount }) %>
  <div class="d-flex">
    <%- include("partials/nav", { currentRoute: 'analytics' }) %>

    <main class="p-4 flex-grow-1">
      <h4 class="mb-4">ðŸ“Š Spending Analytics</h4>

      <% if (totalSpent > 0) { %>
        <div class="card shadow p-4 text-center">
          <h5 class="mb-3">Your Spending Breakdown</h5>

          <!-- Chart Type Selector -->
          <div class="mb-4">
            <label class="form-label me-2">View as:</label>
            <select id="chartTypeSelector" class="form-select d-inline-block w-auto">
              <option value="pie">Pie</option>
              <option value="bar">Bar</option>
              <option value="line">Line</option>
            </select>
          </div>

          <!-- Chart Container -->
          <div class="d-flex justify-content-center">
            <canvas id="spendingChart" style="max-width: 350px; max-height: 350px;"></canvas>
          </div>
        </div>
      <% } else { %>
        <div class="alert alert-info">No transactions found to display.</div>
      <% } %>
    </main>
  </div>

  <script>
    const chartData = <%- JSON.stringify(chartData) %>;
    const ctx = document.getElementById('spendingChart');
    let currentChart;

    function renderChart(type) {
      if (currentChart) currentChart.destroy();

      currentChart = new Chart(ctx, {
        type,
        data: {
          labels: chartData.labels,
          datasets: [{
            label: 'Spending by Category',
            data: chartData.values,
            backgroundColor: [
              '#007bff', '#28a745', '#ffc107', '#dc3545', '#6f42c1',
              '#fd7e14', '#20c997', '#17a2b8', '#e83e8c'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'bottom'
            }
          }
        }
      });
    }

    document.getElementById('chartTypeSelector').addEventListener('change', function () {
      renderChart(this.value);
    });

    renderChart('pie');
  </script>

</body>
</html>
